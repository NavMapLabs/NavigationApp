
name: Node.js CI

on:
  push:
    branches: [ Deployment/CI-CD ]
  pull_request:
    branches: [ Deployment/CI-CD  ]


jobs:
  # Test workflow
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x]
    steps:
    - name: Check out Branch
      uses: actions/checkout@v2

    # use self-define steps to load env
    - name: Load Node.js
      uses: ./.github/actions/setup-and-install
      with:
        node-version: ${{ matrix.node-version }}

    - name: Running Test
      run: npm run test

  # Build workflow 
  # - No actual build workflow since using github-page
  build:
    needs: test
    runs-on: ubuntu-latest
    # strategy:
    #   matrix:
    #     node-version: [16.x]
    steps:
      - name: No Actual Build Workflow Needed At the Moment
        run: echo No Actual Build Workflow Needed At the Moment
      - run: Since we using github page
    # - name: Check out Branch
    #   uses: actions/checkout@v2

    # # use self-define steps to load env
    # - name: Load Node.js
    #   uses: ./.github/actions/setup-and-install
    #   with:
    #     node-version: ${{ matrix.node-version }}

    # - name: building expo project
    #   run: npx expo export -p web  

  # Deployment workflow
  deploy:
    needs: build
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x]
    steps:
    - name: Check out Branch
      uses: actions/checkout@v2
      
    # use self-define steps to load env
    - name: Load Node.js
      uses: ./.github/actions/setup-and-install
      with:
        node-version: ${{ matrix.node-version }}

    - name: Deploy to github page
      run: npm run deploy-github-action